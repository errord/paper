# §2.1 理论基础

## 2.1.1 现代资产配置理论

### 均值-方差模型

Markowitz（1952）奠定了现代投资组合理论的基石，将资产配置问题形式化为在给定风险水平下最大化期望收益的优化问题：

$$
\max_{\mathbf{w}} \quad \mathbf{w}^\top \boldsymbol{\mu} - \frac{\lambda}{2} \mathbf{w}^\top \boldsymbol{\Sigma} \mathbf{w}
$$

$$
\text{s.t.} \quad \mathbf{w}^\top \mathbf{1} = 1, \quad \mathbf{w} \geq \mathbf{0}
$$

其中 $\mathbf{w} \in \mathbb{R}^n$ 为权重向量，$\boldsymbol{\mu} \in \mathbb{R}^n$ 为预期收益向量，$\boldsymbol{\Sigma} \in \mathbb{R}^{n \times n}$ 为协方差矩阵，$\lambda$ 为风险厌恶系数。该模型的理论优雅性与实践局限性并存：最优解对输入参数 $\boldsymbol{\mu}$ 和 $\boldsymbol{\Sigma}$ 高度敏感（Best & Grauer, 1991），且在高维情形下协方差矩阵的估计误差随维度平方级增长（Ledoit & Wolf, 2004）。

**实践约束。** 本文在均值方差优化中加入单一标的集中度约束 $w_i \leq \beta_{max}$（取 $\beta_{max} = 10\%$），以缓解角点解问题并满足券商自营投资的风控要求。

### Black-Litterman模型

Black与Litterman（1992）通过贝叶斯框架将市场均衡收益与投资者主观观点融合，有效缓解了均值-方差模型的输入敏感性问题。

**市场均衡先验。** 假设市场组合为均衡状态，通过逆优化获得隐含均衡收益：

$$
\boldsymbol{\pi} = \delta \boldsymbol{\Sigma} \mathbf{w}_{mkt}
$$

其中 $\delta$ 为风险厌恶系数，$\mathbf{w}_{mkt}$ 为市场组合权重（实践中可用反方差加权近似）。

**投资者观点。** 投资者对资产收益的主观判断以线性约束形式表达：

$$
\mathbf{P}\boldsymbol{\mu} = \mathbf{q} + \boldsymbol{\varepsilon}, \quad \boldsymbol{\varepsilon} \sim N(\mathbf{0}, \boldsymbol{\Omega})
$$

其中 $\mathbf{P} \in \mathbb{R}^{k \times n}$ 为观点矩阵，$\mathbf{q} \in \mathbb{R}^k$ 为观点向量，$\boldsymbol{\Omega}$ 为观点不确定性矩阵。

**贝叶斯后验。** 融合先验与观点，得到后验期望收益：

$$
\hat{\boldsymbol{\mu}}_{BL} = \left[(\tau\boldsymbol{\Sigma})^{-1} + \mathbf{P}^\top \boldsymbol{\Omega}^{-1} \mathbf{P}\right]^{-1} \left[(\tau\boldsymbol{\Sigma})^{-1}\boldsymbol{\pi} + \mathbf{P}^\top \boldsymbol{\Omega}^{-1}\mathbf{q}\right]
$$

其中 $\tau$ 为标量参数，反映先验不确定性的相对程度（通常取 $\tau \approx 0.05$）。

**BL模型的两种变体。** 本文实现两种BL变体：

1. **无观点BL**：令 $\mathbf{P} = \mathbf{0}$（无投资者观点），后验退化为先验 $\hat{\boldsymbol{\mu}}_{BL} = \boldsymbol{\pi}$。此时BL等价于以逆优化均衡收益替代样本均值的MV优化。其优势在于均衡收益远比样本均值稳定，显著降低权重的估计误差敏感性。

2. **动量观点BL**：使用过去 $L$ 天的累计收益率作为量化观点信号，通过截面标准化映射为BL观点向量。该变体测试了BL框架整合量化信号的能力。

> **关键局限：** BL模型的核心仍依赖协方差矩阵的准确估计，且标准BL框架未考虑资产间依赖结构的网络拓扑特征——这正是本文融合创新方法要解决的问题（详见§2.4）。

### 风险平价模型

风险平价（Risk Parity）策略要求每项资产对组合总风险的边际贡献相等（Maillard, Roncalli & Teiletche, 2010）。定义资产 $i$ 的风险贡献为：

$$
RC_i = w_i \cdot \frac{\partial \sigma_p}{\partial w_i} = w_i \cdot \frac{(\boldsymbol{\Sigma}\mathbf{w})_i}{\sqrt{\mathbf{w}^\top\boldsymbol{\Sigma}\mathbf{w}}}
$$

风险平价条件要求 $RC_i = RC_j, \, \forall i,j$，等价于求解：

$$
\min_{\mathbf{w}} \sum_{i=1}^{n}\sum_{j=1}^{n}\left(w_i(\boldsymbol{\Sigma}\mathbf{w})_i - w_j(\boldsymbol{\Sigma}\mathbf{w})_j\right)^2
$$

$$
\text{s.t.} \quad \mathbf{w}^\top \mathbf{1} = 1, \quad \mathbf{w} \geq \mathbf{0}, \quad w_i \leq \beta_{max}
$$

**理论优势：** 不要求预期收益估计，仅依赖协方差矩阵，具有更高的稳健性。Maillard等（2010）证明，当所有资产具有相同的Sharpe比率时，风险平价组合即为有效前沿上的切线组合。

**理论局限：** 隐含假设所有资产具有相同的风险调整后收益；在资产高度相关时（如系统性风险上升期）无法有效分散系统性风险；**协方差矩阵的估计质量直接决定了风险平价的效果**。

### 层次化风险平价（HRP）

López de Prado（2016）提出基于层次聚类的投资组合构建方法，利用树状结构替代逆协方差矩阵进行权重分配，有效回避了矩阵求逆的数值不稳定性。HRP通过三个步骤实现：

1. **树结构构建**：基于相关距离矩阵 $d_{ij} = \sqrt{\frac{1}{2}(1-\rho_{ij})}$（López de Prado, 2016）进行层次聚类（single-linkage方法），得到树状图（dendrogram）；

> **注：** HRP使用的距离度量 $d_{ij} = \sqrt{(1-\rho_{ij})/2}$ 与MST/PMFG的Mantegna距离 $d_{ij} = \sqrt{2(1-\rho_{ij})}$ 不同，两者仅是单调变换关系，不影响聚类结构但影响数值尺度。
2. **矩阵重排**：根据聚类树重排协方差矩阵，使相近资产在矩阵中相邻；
3. **递归分配**：沿树结构自顶向下递归进行反方差分配。在每个分叉节点，将权重按两个子树的方差倒数比例分配。

**HRP的本质洞见：** HRP实质上引入了资产间的**层次依赖结构**进行权重分配。其成功说明：利用资产依赖关系的结构信息（而非仅使用协方差矩阵的数值信息）可以改善投资组合构建。这一洞见为本文将图拓扑信息纳入配置框架提供了方法论先导。

> **从HRP到图模型的理论跨越：** HRP使用二叉树表达资产依赖结构，信息量有限（仅 $n-1$ 个分叉节点）。PMFG网络包含 $3(n-2)$ 条边和丰富的环路结构，能表达更复杂的社区结构和中心性差异。本文的融合方法（特别是社区BL-RP混合策略）可视为HRP在图论框架下的自然推广。

---

## 2.1.2 复杂网络理论在金融中的应用

### 金融网络的理论根基

将金融市场建模为网络的研究始于Mantegna（1999），其核心洞见在于：资产收益率之间的相关性结构蕴含了超越两两关系的高阶依赖信息，而图模型恰好提供了表达和分析这种高阶结构的数学工具。

形式化地，定义金融资产网络为图 $G = (V, E, W)$，其中 $V = \{v_1, \ldots, v_n\}$ 为资产节点集，$E \subseteq V \times V$ 为边集，$W: E \to \mathbb{R}^+$ 为边权函数。边权通常由资产收益率相关系数经距离变换获得。

### 网络中心性的经济学含义

网络中心性度量了节点在网络中的结构重要性，不同中心性指标反映了不同的经济学含义：

**（1）度中心性（Degree Centrality）：**

$$
C_D(i) = \frac{k_i}{n-1}
$$

其中 $k_i$ 为节点 $i$ 的度数。衡量资产与其他资产的直接关联数目，高度中心性意味着该资产与众多资产存在强相关性，是市场共同因子的直接承载者。

**（2）介数中心性（Betweenness Centrality）：**

$$
C_B(i) = \sum_{s \neq i \neq t} \frac{\sigma_{st}(i)}{\sigma_{st}}
$$

其中 $\sigma_{st}$ 为节点 $s$ 到 $t$ 的最短路径数，$\sigma_{st}(i)$ 为经过节点 $i$ 的最短路径数。衡量资产在风险传导路径中的"桥梁"作用，高介数中心性的资产是风险传染的关键中介节点（Billio et al., 2012）。

**（3）特征向量中心性（Eigenvector Centrality）：**

$$
C_E(i) = \frac{1}{\lambda_1}\sum_{j \in \mathcal{N}(i)} C_E(j)
$$

其中 $\lambda_1$ 为邻接矩阵的最大特征值。衡量节点是否与其他高中心性节点相连，反映系统性风险的集聚效应。

**（4）接近中心性（Closeness Centrality）：**

$$
C_C(i) = \frac{n-1}{\sum_{j \neq i} d(i,j)}
$$

衡量资产到网络中所有其他资产的平均距离，高接近中心性的资产对市场整体波动的响应更为迅速。

### 社区结构与资产聚类

网络中的社区结构（Community Structure）反映了资产的自然聚类特征。Girvan与Newman（2002）定义的模块度（Modularity）：

$$
Q = \frac{1}{2m}\sum_{ij}\left[A_{ij} - \frac{k_ik_j}{2m}\right]\delta(c_i, c_j)
$$

其中 $m$ 为总边数，$A_{ij}$ 为邻接矩阵元素，$c_i$ 为节点 $i$ 所属社区，$\delta(\cdot,\cdot)$ 为Kronecker函数。高模块度表明网络存在明显的群组结构，对应于资产市场中的板块效应或行业聚集现象。

---

## 2.1.3 协方差矩阵的稳健估计

传统样本协方差矩阵在高维小样本情形下（$n/T$ 较大时）存在严重的估计偏差，其条件数过大导致矩阵求逆不稳定（Marchenko & Pastur, 1967）。本文采用三种互补的估计方法：

### Ledoit-Wolf收缩估计

Ledoit与Wolf（2004）提出将样本协方差矩阵向结构化目标收缩：

$$
\hat{\boldsymbol{\Sigma}}_{LW} = \alpha \mathbf{F} + (1-\alpha)\mathbf{S}
$$

其中 $\mathbf{S}$ 为样本协方差矩阵，$\mathbf{F}$ 为收缩目标（如恒定相关模型），$\alpha \in [0,1]$ 为最优收缩强度，由渐近最优公式解析确定。收缩估计在均方误差意义下优于样本协方差矩阵，且保证正定性。

**局限：** Ledoit-Wolf收缩是均匀收缩，对所有资产对施加相同的收缩强度，不区分哪些相关性是信号、哪些是噪声。

### Graphical LASSO

Friedman等（2008）提出通过 $\ell_1$ 正则化估计精度矩阵（协方差逆矩阵）：

$$
\hat{\boldsymbol{\Theta}} = \arg\max_{\boldsymbol{\Theta} \succ 0} \left[\log\det\boldsymbol{\Theta} - \text{tr}(\mathbf{S}\boldsymbol{\Theta}) - \rho\|\boldsymbol{\Theta}\|_1\right]
$$

其中 $\boldsymbol{\Theta} = \boldsymbol{\Sigma}^{-1}$ 为精度矩阵，$\rho > 0$ 为正则化参数。Graphical LASSO具有双重功能：一方面提供稳健的协方差逆矩阵估计；另一方面，精度矩阵的稀疏结构直接对应于资产间的**条件独立性**关系——$\Theta_{ij} = 0$ 意味着在控制其他所有资产后，资产 $i$ 与 $j$ 条件独立。

### ★ RMT协方差去噪（v2新增）

随机矩阵理论（Random Matrix Theory, RMT）提供了一种**结构化去噪**方法，相较于Ledoit-Wolf的均匀收缩更为精细（Laloux et al., 1999; López de Prado, 2020）。

**Marchenko-Pastur定律。** 对于 $T \times n$ 的随机矩阵（元素独立同分布），其样本相关矩阵的特征值分布在 $T, n \to \infty$（$n/T \to q$）时趋近于：

$$
f(\lambda) = \frac{T}{2\pi\sigma^2}\frac{\sqrt{(\lambda_+ - \lambda)(\lambda - \lambda_-)}}{\lambda}
$$

其中 $\lambda_{\pm} = \sigma^2(1 \pm \sqrt{n/T})^2$ 为特征值分布的上下界。

**去噪原理。** 对于真实金融数据的样本相关矩阵：

- **信号特征值**：超过 $\lambda_+$ 的特征值，对应于真实的市场因子（市场beta、行业效应、风格因子），其对应特征向量与PMFG社区结构高度一致；
- **噪声特征值**：落在 $[\lambda_-, \lambda_+]$ 区间内的特征值，主要由有限样本估计误差产生。

去噪过程保留信号特征值不变，将噪声特征值替换为其均值（保持矩阵迹不变），然后重构协方差矩阵：

$$
\hat{\boldsymbol{\Sigma}}_{RMT} = \boldsymbol{U} \text{diag}(\tilde{\lambda}_1, \ldots, \tilde{\lambda}_n) \boldsymbol{U}^\top
$$

其中：

$$
\tilde{\lambda}_i = \begin{cases}
\lambda_i, & \text{if } \lambda_i > \lambda_+ \quad \text{（信号特征值，保留）} \\
\bar{\lambda}_{noise}, & \text{if } \lambda_i \leq \lambda_+ \quad \text{（噪声特征值，收缩）}
\end{cases}
$$

**与Ledoit-Wolf收缩的对比。**

| 特性 | Ledoit-Wolf收缩 | RMT去噪 |
|------|----------------|---------|
| 收缩方式 | 均匀收缩所有资产对 | 选择性收缩噪声维度 |
| 理论基础 | 渐近最优均方误差 | 随机矩阵特征值分布 |
| 保留信号 | 部分（收缩强度统一） | 完全（信号特征值不变） |
| 适用条件 | 任意 $n/T$ 比例 | $n/T$ 不宜过大 |
| 与网络的关系 | 无 | 信号特征向量对应网络社区 |

**RMT去噪的关键优势**在于它**选择性地**保留了协方差矩阵中的真实结构信息（对应于网络的社区结构），同时消除了估计噪声，为后续的风险平价优化提供了更高质量的输入。

---

## 参考文献（本节）

- Markowitz, H. (1952). Portfolio selection. *Journal of Finance*, 7(1), 77-91.
- Black, F., & Litterman, R. (1992). Global portfolio optimization. *Financial Analysts Journal*, 48(5), 28-43.
- Maillard, S., Roncalli, T., & Teiletche, J. (2010). The properties of equally weighted risk contribution portfolios. *Journal of Portfolio Management*, 36(4), 60-70.
- López de Prado, M. (2016). Building diversified portfolios that outperform out of sample. *Journal of Portfolio Management*, 42(4), 59-69.
- Mantegna, R. N. (1999). Hierarchical structure in financial markets. *European Physical Journal B*, 11, 193-197.
- Billio, M., Getmansky, M., Lo, A. W., & Pelizzon, L. (2012). Econometric measures of connectedness and systemic risk in the finance and insurance sectors. *Journal of Financial Economics*, 104(3), 535-559.
- Girvan, M., & Newman, M. E. (2002). Community structure in social and biological networks. *PNAS*, 99(12), 7821-7826.
- Ledoit, O., & Wolf, M. (2004). A well-conditioned estimator for large-dimensional covariance matrices. *Journal of Multivariate Analysis*, 88(2), 365-411.
- Friedman, J., Hastie, T., & Tibshirani, R. (2008). Sparse inverse covariance estimation with the graphical lasso. *Biostatistics*, 9(3), 432-441.
- Laloux, L., Cizeau, P., Bouchaud, J. P., & Potters, M. (1999). Noise dressing of financial correlation matrices. *Physical Review Letters*, 83(7), 1467-1470.
- López de Prado, M. (2020). *Machine Learning for Asset Managers*. Cambridge University Press.
- Best, M. J., & Grauer, R. R. (1991). On the sensitivity of mean-variance-efficient portfolios to changes in asset means. *Review of Financial Studies*, 4(2), 315-342.
- Marchenko, V. A., & Pastur, L. A. (1967). Distribution of eigenvalues for some sets of random matrices. *Mathematics of the USSR-Sbornik*, 1(4), 457.
