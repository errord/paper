# §2.2 图模型构建方法论

## 2.2.1 相关性度量与距离变换

设 $n$ 项资产在时间窗口 $[t-\tau, t]$ 内的对数收益率序列为 $\{r_{i,s}\}_{s=t-\tau}^{t}$，$i = 1, \ldots, n$。计算Pearson相关系数矩阵：

$$
\rho_{ij} = \frac{\text{Cov}(r_i, r_j)}{\sigma_i \sigma_j}
$$

将相关系数转化为满足度量空间公理的距离：

$$
d_{ij} = \sqrt{2(1 - \rho_{ij})}
$$

**度量性质验证（Mantegna, 1999）。** 该距离函数满足：
1. 非负性：$d_{ij} \geq 0$；
2. 同一性：$d_{ij} = 0 \Leftrightarrow \rho_{ij} = 1$；
3. 对称性：$d_{ij} = d_{ji}$；
4. 三角不等式：$d_{ij} \leq d_{ik} + d_{kj}$。

满足欧几里得度量性质保证了后续MST和PMFG构建的数学合法性。

**替代距离函数。** 作为稳健性检验，本文同时考虑基于互信息近似的非线性距离变换：

$$
d_{ij}' = \sqrt{1 - \rho_{ij}^2}
$$

该距离对正负相关给予相同权重，适用于检验线性相关假设对结果的影响。当标准距离 $d_{ij}$ 与替代距离 $d_{ij}'$ 给出一致的网络结构时，增强了结论的稳健性。

---

## 2.2.2 网络过滤方法

由完全相关矩阵直接构建的网络包含 $n(n-1)/2$ 条边，噪音严重且难以分析。本文采用三种互补的网络过滤方法：

### 方法一：最小生成树（MST）

对完全加权图 $G = (V, E, d)$，使用Kruskal算法（Kruskal, 1956）求最小生成树：

$$
T^* = \arg\min_{T \in \mathcal{T}} \sum_{(i,j) \in T} d_{ij}
$$

其中 $\mathcal{T}$ 为所有生成树的集合。MST保留 $n-1$ 条边，提取了资产间最强的层级依赖结构。

**MST的结构性质：**
- 恰好包含 $n-1$ 条边；
- 平均度为 $\bar{k} = 2(n-1)/n$；
- 不含环路，为树结构；
- 任意两节点间存在唯一路径。

**MST的局限性：** MST仅保留 $n-1$ 条边（信息压缩比约 $2/n$），可能因单条边的变化而导致社区结构的大幅重组。此外，树结构无环路，传统模块度优化在MST上的意义有限，社区检测应在信息更丰富的网络上进行。

### 方法二：平面最大过滤图（PMFG）

Tumminello等（2005）提出PMFG，保留 $3(n-2)$ 条边，同时要求所得图嵌入在平面（亏格为零的曲面）上：

$$
G^*_{PMFG} = \arg\max_{G \in \mathcal{P}} \sum_{(i,j) \in G} \rho_{ij}
$$

其中 $\mathcal{P}$ 为所有平面图的集合。PMFG相比MST保留了约3倍的边信息，能更准确地刻画社区结构和中心性分布，且MST是PMFG的子图。

### 方法三：基于Graphical LASSO的条件依赖网络

利用Graphical LASSO（Friedman et al., 2008）估计稀疏精度矩阵 $\hat{\boldsymbol{\Theta}}$，定义条件依赖网络：

$$
A_{ij}^{GL} = \begin{cases} 1, & \text{if } \hat{\Theta}_{ij} \neq 0, \, i \neq j \\ 0, & \text{otherwise} \end{cases}
$$

该网络中的边表示控制其他所有资产后仍存在的**直接依赖关系**，排除了由共同因子导致的伪相关。

**PMFG网络 vs Graphical LASSO网络的本质区别：**
- PMFG基于**边际相关性**（无条件相关），保留了包括间接传导在内的所有强关联；
- GLASSO基于**条件相关性**（偏相关），仅保留排除中介效应后的直接关联。

当两种网络给出一致的社区结构和中心性排序时，增强了结论的可信度。

### 三种过滤方法的综合比较

| 性质 | MST | PMFG | GLASSO |
|------|-----|------|--------|
| 边数 | $n-1$ | $3(n-2)$ | 自适应（由$\rho$控制） |
| 相关性类型 | 边际相关 | 边际相关 | 条件相关 |
| 信息保留 | 骨干层级结构 | 社区内连接 + 跨社区桥梁 | 直接依赖关系 |
| 中心性计算 | 度中心性区分度有限 | 所有中心性指标均有效 | 反映条件依赖结构 |
| 社区检测 | 不适用（无环路） | 适用（含环路结构） | 适用 |
| 计算复杂度 | $O(n^2\log n)$ | $O(n^2)$（贪心算法） | $O(n^3)$（迭代） |
| 适用场景 | 层级结构分析、可视化 | 社区检测、中心性度量 | 条件依赖网络、稳健性验证 |

**本文策略：** 采用PMFG作为主要网络构建方法（用于社区检测和中心性计算），MST作为辅助工具（用于可视化和层级结构分析），GLASSO作为稳健性验证。

---

## 2.2.3 社区检测

### PMFG上的Louvain社区检测

在PMFG网络上应用Louvain算法（Blondel et al., 2008）进行社区检测，该算法通过两阶段迭代优化模块度：

$$
\Delta Q = \frac{1}{2m}\left[\frac{\sum_{in} + 2k_{i,in}}{2m} - \left(\frac{\sum_{tot} + k_i}{2m}\right)^2\right] - \frac{1}{2m}\left[\frac{\sum_{in}}{2m} - \left(\frac{\sum_{tot}}{2m}\right)^2 - \left(\frac{k_i}{2m}\right)^2\right]
$$

其中 $\sum_{in}$ 为社区内部边权之和，$\sum_{tot}$ 为社区内节点度之和，$k_i$ 为节点 $i$ 的度，$k_{i,in}$ 为节点 $i$ 与社区内部的连接权重。

社区划分结果将 $n$ 项资产分为 $K$ 个社区 $\{S_1, S_2, \ldots, S_K\}$，满足 $\bigcup_{k=1}^{K} S_k = V$ 且 $S_k \cap S_l = \emptyset, \forall k \neq l$。

**为何在PMFG而非MST上进行社区检测。** MST为树结构（无环路），模块度的极大化在树上缺乏统计效力——树的任意划分都不存在社区"内部的额外连接"。PMFG包含 $3(n-2)$ 条边和丰富的环路结构，为模块度优化提供了充分的统计信息。

---

## 2.2.4 网络显著性检验

MST和PMFG总是可以从任意相关矩阵中构建，即使数据来自独立同分布的随机变量。因此，必须检验观察到的网络拓扑特征是否显著偏离随机水平。

### 检验一：随机矩阵理论（RMT）基准

根据Marchenko-Pastur定律（1967），若 $n$ 项资产的 $T$ 期收益率为独立同分布，则样本相关矩阵的特征值分布趋近于：

$$
f(\lambda) = \frac{T}{2\pi\sigma^2}\frac{\sqrt{(\lambda_+ - \lambda)(\lambda - \lambda_-)}}{\lambda}
$$

其中 $\lambda_{\pm} = \sigma^2(1 \pm \sqrt{n/T})^2$。落在 $[\lambda_-, \lambda_+]$ 之外的特征值携带真实的相关性信号。本文首先通过RMT确认相关矩阵中存在超越噪音的有效信号。

### 检验二：随机网络对比

生成1000组与观测数据维度相同的随机收益率矩阵（保持各资产的边际分布但破坏相关结构），分别构建MST和PMFG，统计随机网络的拓扑指标（平均路径长度、聚集系数、模块度等）分布。若观测网络的指标显著偏离随机分布（$p < 0.05$），则确认网络拓扑特征反映了真实的市场结构而非统计噪音。

### 检验三：度分布保持的重连检验

采用Maslov-Sneppen重连方法（Maslov & Sneppen, 2002）：在保持原始网络度分布不变的前提下，随机重连边1000次，检验以下零假设——"社区结构和核心节点仅由度分布决定，而非反映更深层的连接模式"。

若观测网络的模块度和中心性集中度显著高于度保持随机网络，则确认网络结构包含超越度分布的真实信息。

---

## 参考文献（本节）

- Mantegna, R. N. (1999). Hierarchical structure in financial markets. *European Physical Journal B*, 11, 193-197.
- Kruskal, J. B. (1956). On the shortest spanning subtree of a graph. *Proceedings of the AMS*, 7(1), 48-50.
- Tumminello, M., Aste, T., Di Matteo, T., & Mantegna, R. N. (2005). A tool for filtering information in complex systems. *PNAS*, 102(30), 10421-10426.
- Friedman, J., Hastie, T., & Tibshirani, R. (2008). Sparse inverse covariance estimation with the graphical lasso. *Biostatistics*, 9(3), 432-441.
- Blondel, V. D., Guillaume, J. L., Lambiotte, R., & Lefebvre, E. (2008). Fast unfolding of communities in large networks. *JSTAT*, 2008(10), P10008.
- Maslov, S., & Sneppen, K. (2002). Specificity and stability in topology of protein networks. *Science*, 296(5569), 910-913.
- Marchenko, V. A., & Pastur, L. A. (1967). Distribution of eigenvalues for some sets of random matrices. *Mathematics of the USSR-Sbornik*, 1(4), 457.
